!add meta type PostScript file-name "mdc.ps"
!open meta
!act meta

*****************CELL***********************
&CELL
solids
wire  centre 0 0.0 0.0 ...
      direction 1 0 0 ...
      radius 0.001 ... 
      half-length 0.5 ...
      conductor-2 ...
      label s ...
      voltage 0
wire  centre 0 0.3 0.0 ...
      direction 1 0 0 ...
      radius 0.001 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700
wire  centre 0 -0.3 0.0 ...
      direction 1 0 0 ...
      radius 0.001 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700
wire  centre 0.1 0 0.25 ...
      direction 0 1 0 ...
      radius 0.004 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700
wire  centre -0.1 0 0.25 ...
      direction 0 1 0 ...
      radius 0.004 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700
wire  centre 0.1 0 -0.25 ...
      direction 0 1 0 ...
      radius 0.004 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700
wire  centre -0.1 0 -0.25 ...
      direction 0 1 0 ...
      radius 0.004 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700
wire  centre 0.3 0 0.25 ...
      direction 0 1 0 ...
      radius 0.004 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700
wire  centre -0.3 0 0.25 ...
      direction 0 1 0 ...
      radius 0.004 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700
wire  centre 0.3 0 -0.25 ...
      direction 0 1 0 ...
      radius 0.004 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700
wire  centre -0.3 0 -0.25 ...
      direction 0 1 0 ...
      radius 0.004 ... 
      half-length 0.5 ...
      conductor-1 ...
      voltage -1700

nebem max-elem 5

*opt nodebug

*****************FIELD**********************
&field
*track FROM 0. 1. TO 0. -1.
*grid 40 40 

area -0.4 -0.4 -0.4 0.4 0.4 0.4 view y=0
grid 50
plot-field surface e

area -0.4 -0.4 -0.4 0.4 0.4 0.4 view x=0
grid 50
plot-field surface e



*****************MAGNETIC*******************
&magnetic
components  0.00  0.00  0.00 T 

*****************GAS************************
&gas
gas-id "ar/co2 70/30"
global gas_file `ar_co270-30-293-760.dat`
temperature 293
pressure 760
Call inquire_file(gas_file,exist)
If exist Then
Say "Gas file exists, retrieving ..."
get {gas_file}
Else
Say "Gas file not found, generating ..."
magboltz argon 70. carbon-dioxide 30. mobility 1.000000
write dataset "ar_co270-30-293-760.dat" gasdata remark "magboltz-ar70-co230"
Endif
heed argon 70. carbon-dioxide 30.

*****************DRIFT**********************
&drift
SEL s
area -0.40 -0.40 -0.40 0.40 0.40 0.40 view y=0 rot 180 3d

*****************SIGNAL*********************
&signal
*Track starting from left side
area -0.40 -0.40 -0.40 0.40 0.40 0.40 view y=0 rot 180 3d
SELECT s
AVALANCHE fixed 44130
INTEGRATION-PARAMETERS  MONTE-CARLO-COLLISIONS 500 M-C-DIST-INT 0.000500 MAX-STEP 0.001000 INT-ACC 1.e-10 PROJECTED TRAP-RADIUS 1.010000
OPTIONS NOCLUSTER-PLOT NOCLUSTER-PRINT
****************Loop over distance**********
For j From 1 To 1 Do
*-------------------------------------------
Global r= 0.01*j
Global alphaDEG=0.0
Global alphaRAD=pi/180.*alphaDEG
Global dx=0.1
Global dy=dx*tan(pi/2.+alphaRAD)
Global x1=r*cos(alphaRAD)
Global y1=r*sin(alphaRAD)
Global x=( 0.25-(y1-x1*tan(pi/2.+alphaRAD)))/tan(pi/2.+alphaRAD)
Global y=  0.25
TRACK FROM {x} {y} DIRECTION {dx} {dy}  RANGE 7.000000 HEED electron energy  0.70 GeV
*-------------------------------------------
TIME-WINDOW 0.0 0.001 1000
****************Loop over signal************
For i From 1 To 1  Do
SIGNAL AVALANCHE NOELECTRON-PULSE ION-TAIL RUNGE-KUTTA-DRIFT-LINES
*WRITE-SIGNALS DATASET "garfield_mdc-0_angle-0.txt" REMARK "p {j} n {i}" UNITS NANO-SECOND
enddo
****************End Loop over signal*********
enddo
****************End Loop over distance*******

